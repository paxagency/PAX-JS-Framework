var $pax=function(t){};$pax.prototype={url:[],routes:{},routeTags:{},routeHash:0,apps:{},appLength:0,appIndex:0,loadMethods:{},routeFade:1,routeMove:1,el:{routes:"#routes"},init:function(t){var e=this;this.appGlob=[],this.appInit=[],$("template").each(function(){var t=$(this).attr("pax"),a=$(this).attr("pax-url"),i=$(this).html();if(void 0!==t)"index"==(a=t.split("_").join("/"))&&(a=""),e.apps[t]?(e.apps[t].template||(e.apps[t].template=i),e.apps[t].url||(e.apps[t].url="/"+a)):e.apps[t]={template:i,url:"/"+a};else if(void 0!==a){var s=a.split("_").join("/");e.apps[a]={url:"/"+s,template:i}}}),$.each(this.apps,function(t,a){e.setDefaults(a),a.url?(e.routes[a.url]=t,a.root=e.el.routes):a.global?e.appGlob.push(t):a.ignore||e.appInit.push(t)}),this.setRouter(),this.loadApps(e.appGlob,function(){e.loadApps(e.appInit,function(){e.routing()})})},setDefaults:function(t){return t.root=t.root?t.root:0,t.el=t.el?t.el:{},t.tag=t.tag?t.tag:{},t.data=t.data?t.data:{},t.values=t.values?t.values:{},t.str=t.str?t.str:{},t.templates=t.templates?t.templates:{},t.filters=t.filters?t.filters:{},t.change=t.change?t.change:{},t},loadApps:function(t,e){if(t&&t.length){var a=this;this.appTotal=t.length,this.appIndex=0,$.each(t,function(t,i){a.apps[i].init&&a.apps[i].init(),a.loadRequests(i,e)})}else e&&e()},loadRequests:function(t,e){var a=this,i=this.apps[t],s=i.load?Object.keys(i.load).length:0;if(s){var n=0;$.each(i.load,function(r,l){if(l.url){var o=l.query?l.query:0;a.ajax(l.url,o,function(l){i.load[r].data=l,i.load[r].init&&a.call(l,i.load[r].init),i.load[r].ready&&(a.loadMethods[t]||(a.loadMethods[t]=[]),a.loadMethods[t].push({method:i.load[r].ready,data:l})),n++,a.finished(t,e,s,n)})}else n++,a.finished(t,e,s,n)})}else a.finished(t,e)},call:function(t,e){var a=e.split("."),i=window.app;return $.each(a,function(t,e){i=i[e]}),i(t||0)},finished:function(t,e,a,i){a&&a!=i||(this.appIndex++,this.initApp(t),this.appTotal==this.appIndex&&e&&e())},initApp:function(t){var e=this,a=this.apps[t];!a.root&&$(['pax="'+t+'"']).length&&(a.root='[pax="'+t+'"]'),a.prerend&&a.prerend(),a.root&&this.renderApp(t),a.ready&&a.url&&this.activeRoute==t&&a.ready(),this.loadMethods[t]&&$.each(this.loadMethods[t],function(t,a){e.call(a.data,a.method)})},renderApp:function(t){var e=this.apps[t];e.set=function(e,a,i){pax.set(t,e,a,i)},e.push=function(e,a,i){pax.push(t,e,a,i)},e.pop=function(e,a){pax.pop(t,e,a)},e.render=function(){pax.renderChildren(t)},e.template||(e.template=$(e.root).html()),$(e.root).html(this.rendTemplate(t)),this.routeFade&&($(e.root).attr("styles","opacity:0;transition: opacity 0.3s;"),$(e.root).css("opacity","1")),this.routeMove&&$("html, body").animate({scrollTop:0},100),this.renderChildren(t)},renderChildren:function(t){var e=this,a=this.apps[t];$(a.root).find("[pax]").each(function(i,s){var n=$(s).prop("tagName"),r=$(s).attr("pax");if(a.el[r]=$(s),"template"==n)return!1;"SELECT"==n&&$(s)[0].hasAttribute("multiple")&&(n="MULTIPLE"),"INPUT"==n&&"checkbox"==$(s).attr("type")&&(n="CHECKBOX"),"INPUT"==n&&"radio"==$(s).attr("type")&&(n="IGNORE"),"INPUT"==n&&"button"==$(s).attr("type")&&(n="BUTTON"),"INPUT"==n&&"submit"==$(s).attr("type")&&(n="BUTTON"),$(s).attr("pax-type")&&(n=$(s).attr("pax-type").toUpperCase()),a.tag[r]=n;$(s).html();switch(n){case"UL":case"OL":a.templates[r]||(a.templates[r]='<li data-index="{{index}}">{{value}}</li>'),a.data[r]?e.render(t,r):(a.data[r]=[],$(s).find("li").each(function(t,e){a.data[r].push($(e).html())}));break;case"RADIO":a.templates[r]||(a.templates[r]="<label><input type='radio' value='{{this.id}}' name='"+r+"'>{{this.text}}</label> "),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find('input[name="'+r+'"]').each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).find('input[name="'+r+'"][value="'+a.values[r].id+'"]').attr("checked",!0),$(a.el[r]).find('input[name="'+r+'"]').on("change",{self:e},function(a){e.setData(t,r)});break;case"CHECKBOX":a.data[r]?($(s).parent().html("<label><input type='checkbox' name='"+r+"' pax='"+r+"' />"+a.data[r].text+"</label>"),a.data[r].id&&$(s).prop("checked",!0)):a.data[r]={id:0,text:$(this).parent().text()},$(a.el[r]).on("change",{self:e},function(e){e.data.self.setData(t,r)});break;case"INPUT":a.data[r]||0==a.data[r]?$(s).val(a.data[r]):a.data[r]=e.numString($(s).val()),$(a.el[r]).on("keyup",{self:e},function(e){e.data.self.setData(t,r)});break;case"TEXTAREA":a.data[r]?$(s).html(a.data[r]):a.data[r]=e.numString($(s).html()),$(a.el[r]).on("focusout",{self:e},function(e){e.data.self.setData(t,r)});break;case"SELECT":a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).val(a.values[r].id),$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;case"TABLE":var l=a.templates[r]?a.templates[r]:0;$(a.el[r]).html(e.table(a.data[r],l));break;case"MULTIPLE":if(a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]){var o=[];$.each(a.values[r],function(t,e){o.push(e.id)}),o.length&&$(a.el[r]).val(o)}$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;default:a.templates[r]||(a.templates[r]="{{value}}"),a.data[r]||(a.data[r]=e.numString($(s).html())),e.render(t,r)}})},render:function(t,e){if(this.apps[t]){if(!e)return this.loadApps([t]);var a=this,i=this.apps[t],s=(i.tag[e],i.data[e]),n="";if(s||(s=""),Array.isArray(s))i.templates[e]?$.each(i.data[e],function(s,r){var l=i.templates[e].valueOf().toString();l=(l=(l=l.split("{{index}}").join(s)).split("{{value}}").join(r)).split("{{this").join("{{"+t+".data."+e+"["+s+"]"),l=a.tempString(l,t,r,s,e),n+=l}):n=JSON.stringify(s);else if("object"==typeof s){if(i.templates[e])r=(r=(r=i.templates[e].valueOf().toString()).split("{{this").join("{{"+t+".data."+e)).split("{{value").join("{{"+t+".data."+e),r=a.tempString(r,t,i.data[e],0,e),n+=r;else n=JSON.stringify(s)}else{var r,l=i.data[e];if(i.templates[e])r=(r=(r=i.templates[e].valueOf().toString()).split("{{this").join("{{"+t+".data")).split("{{value").join("{{"+t+".data."+e),r=a.tempString(r,t,i.data[e],0,e),n+=r;else n=l}return $(i.el[e]).html(n),n}alert('App "'+t+'" does not exist')},rendTemplate:function(t){if(!this.apps[t].template)return"";var e=this.apps[t].template.valueOf().toString();return-1==e.indexOf("{{")?e:(e=e.split("this.").join(t+".data."),this.tempString(e,t))},tempString:function(t,e,a,i,s){var n=this;return t.replace(/\{\{[^\}]*\}\}/g,function(t,r){return n.tempValue(t,e,a,i,s)})},tempValue:function(s,key,obj,n,id){var self=this;s=s.replace("{{","").replace("}}","").replace("()",""),s=s.split("||");var v=eval("this.apps."+s[0].trim());return"function"==typeof v&&(v=void 0!==n?v(n,obj):v(obj)),s[1]&&!v&&(v=s[1].trim()),this.apps[key].filters[id]&&(v=this.apps[key].filters[id](v)),void 0!==v?v:""},setData:function(t,e){var a=this.apps[t],i=a.tag[e],s=a.el[e];switch(i){case"RADIO":a.values[e]={id:$(s).find("input:checked"),text:$(s).find('input[value="'+$(s).val()+'"]').html()};break;case"CHECKBOX":var n=$(s).prop("checked")?1:0;a.data[e]=a.values[e]={id:n,text:$(s).parent().text()};break;case"INPUT":case"TEXTAREA":a.values[e]=a.data[e]=$(s).val();break;case"SELECT":a.values[e]={id:$(s).val(),text:$(s).find(":selected").html()};break;case"MULTIPLE":a.values[e]=[];var r=$(s).val();$.each(r,function(t,i){a.values[e].push({id:i,text:$(s).find('option[value="'+i+'"]').html()})})}a.change[e]&&a.change[e](a.data[e],e,t)},numString:function(t){return t},setHTML:function(t,e){var a=this.apps[t],i=a.data[e],s=a.tag[e],n=a.el[e];switch(s){case"UL":$(n).html(this.render(t,e));break;case"RADIO":a.values[e]&&$(n).find('input[name="'+e+'"][value="'+a.values[e].id+'"]').attr("checked",!0);break;case"CHECKBOX":i?$(n).prop("checked",!0):$(n).prop("checked",!1);break;case"INPUT":case"TEXTAREA":$(n).val(i);break;case"SELECT":a.values[e]&&$(n).val(a.values[e].id);break;case"MULTIPLE":if(a.values[e]){var r=[];$.each(a.values[e],function(t,e){r.push(e.id)}),r.length?$(n).val(r):$(n).val("")}}a.change[e]&&a.change[e](a.data[e])},set:function(t,e,a,i){""==a&&(a=null);var s=this.apps[t];i?this._set(e,a,s.values):this._set(e,a,s.data),e.indexOf(".")>-1&&(e=e.split(".")[0]),s.change[e]&&s.change[e](a,e,t),s.templates[e]&&!i?(this.render(t,e),this.setHTML(t,e)):this.setHTML(t,e)},load:function(t){var e=this;$.each(t,function(t,a){e.set(t,a)})},setVar:function(t,e,a){if(a){var i=e.split("."),s=i.length-1;this.va[t]||(this.va[t]={});var n=this.va[t];$.each(i,function(t,e){n[e]||(n[e]={}),t==s&&(n[e]=a),n=n[e]})}},push:function(t,e,a,i){""==a&&(a=null);var s=this.apps[t];null!=typeof i?s.data[e].splice(i,0,a):s.data[e].push(a),s.change[e]&&s.change[e](s.data[e],e,t),s.templates[e]?this.render(t,e):this.setHTML(t,e)},pop:function(t,e,a){var i=this.apps[t];null!=typeof a?i.data[e].splice(a,1):i.data[e].pop(),i.change[e]&&i.change[e](i.data[e],e,t),i.templates[e]?this.render(t,e):this.setHTML(t,e)},getVals:function(t){var e=this,a={};return $.each(t,function(t,i){a[i]=e.data[i]}),a},print:function(t){if(!t)return alert(JSON.stringify(this.data,null,2));alert(JSON.stringify(t,null,2))},log:function(t){window.console.log(t)},href:function(t){window.location.href=t},link:function(t){window.history.pushState(t,t,t),this.setPath(t)},setRouter:function(){var t=this;this.routeHash?window.addEventListener("hashchange",function(){t.setPath()}):window.onpopstate=function(e){t.setPath(e.state)},this.setPath(0,1)},setPath:function(t,e){this.routeHash?this.url=location.hash.substr(2).split("/"):this.url=t?t.substr(1).split("/"):window.location.pathname.substr(1).split("/"),e||this.routing()},routing:function(){for(var t="/error",e="",a="",i=0,s=this.url.length;i<s;i++)e+=i?"/"+this.url[i]:this.url[i],a+=i?"_"+this.url[i]:this.url[i],this.routes["/"+e]&&(t="/"+e),this.routeTags[a]&&a;if(this.routes[t]){this.routeInit&&this.routeInit();var n=this.routes[t];this.activeRoute=this.routes[t],this.loadApps([n]),this.routeReady&&this.routeReady(),$.each(this.apps,function(t,e){e.appReady&&e.appReady()})}},parse:function(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(t){return{error:1,message:"Server Error"}}},ajax:function(t,e,a){var i=this;e?$.post(t,e).done(function(t){(t=i.parse(t))||(t="{error:1}"),i.animate&&$("html,body").animate({scrollTop:0},"slow"),i.el_progress&&$(i.el_progress).hide(),a?a(t):i.complete(t)}).fail(function(t,e){i.el_progress&&$(i.el_progress).hide(),a?a({error:!0,xhr:t,status:e}):i.complete({error:!0,xhr:t,status:e})}):$.get(t).done(function(t){t=i.parse(t),a&&a(t)}).fail(function(t,e){a?a({error:!0,xhr:t,status:e}):i.complete({error:!0,xhr:t,status:e})})},_get:function(t,e){return t?(e=e||window,t.indexOf(".")<0?void 0!==e[t]?e[t]:"":t.split(".").reduce(function(t,e){return t?t[e]:""},e)):""},_set:function(t,e,a,i){return t?(a=a||window,t.indexOf(".")>-1&&(t=t.split(".")),Array.isArray(t)&&t.length>1?(a.hasOwnProperty(t[0])&&"object"==typeof a[t[0]]||(a[t[0]]=Number.isInteger(parseInt(t[1]))?[]:{}),i=i||a[t[0]],this._set(t.slice(1),e,a[t[0]],i)):(a[t]=e,i)):""},clone:function(t){var e=JSON.parse(JSON.stringify(t));return $.each(t,function(t,a){"function"==typeof a&&(e[t]=a)}),e},table:function(t,e,a){var i=this;if(this.mode=0,a||(a={}),0==t.length)return"<tbody><tr id='tr-0'><td style='text-align:center;'>There are no results</td></tr></tbody>";var s="<thead><tr>";if(e)$.each(e,function(t,e){if(e.thead){var i=a.thClick?"onclick='"+a.thClick+"(this)'":"";s+="<th "+i+" data-id="+e.id+" data-index="+t+">"+e.thead+"</th>"}});else{var n=this.mode?t[0]._source:t[0];$.each(n,function(t,e){s+="<th>"+t+"</th>"})}return s+="</tr></thead><tbody>",e?($.each(t,function(t,n){i.mode&&(n._source._id=n._id),n=i.mode?n._source:n;var r="";a.trAttr&&$.each(a.trAttr,function(t,e){r+=" data-"+e+'="'+n[e]+'"'}),s+="<tr "+r+"  data-index='"+t+"'>",$.each(e,function(t,e){var l=e.id;r="",a.attr&&$.each(a.attr,function(t,e){r+=" data-"+t+'="'+e+'"'}),e.attr&&$.each(e.attr,function(t,e){r+=" data-"+t+'="'+e+'"'});var o=a.tdClick?"onclick='"+a.tdClick+"(this)'":"";e.tdClick&&e.tdClick;var p=e.val?e.val:i._get(l,n);e.key&&(p=e.key[p]),e.call&&(p=e.call(p)),s+=null!=p?"<td "+o+" "+r+">"+p+"</td>":"<td "+o+" "+r+"></td>"}),s+="</tr>"}),s+"</tbody>"):($.each(t,function(t,e){i.mode&&(e._source._id=e._id);var n=(e=i.mode?e._source:e)._id?"data-id='"+e._id+"'":"",r="";a.trAttr&&$.each(a.trAttr,function(t,a){r+=" data-"+a+'="'+e[a]+'"'}),s+="<tr "+r+" "+n+" data-index='"+t+"'>";var l=a.tdClick?"onclick='"+a.tdClick+"(this)'":"";$.each(e,function(t,e){s+=null!=e?"<td "+l+">"+e+"</td>":"<td></td>"}),s+="</tr>"}),s+"</tbody>")}};