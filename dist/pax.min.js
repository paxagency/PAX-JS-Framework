var $pax=function(t){};$pax.prototype={url:[],routes:{},routeTags:{},routeHash:0,apps:{},appLength:0,appIndex:0,routeFade:1,routeMove:1,appGlob:[],appInit:[],el:{routes:"#routes"},init:function(t){var e=this;$("template").each(function(){var t=$(this).attr("pax"),a=$(this).html();if(void 0!==t){var i=t.split("_").join("/");"index"==i&&(i=""),e.apps[t]||(e.apps[t]={}),e.apps[t].template||(e.apps[t].template=a),e.apps[t].url||(e.apps[t].url="/"+i)}}),$.each(this.apps,function(t,a){e.setDefaults(a),a.url?(e.routes[a.url]=t,a.root=e.el.routes):a.global?e.appGlob.push(t):a.ignore||e.appInit.push(t)}),this.setRouter(),this.loadApps(e.appGlob,function(){e.loadApps(e.appInit,function(){e.routing()})})},setDefaults:function(t){return t.root=t.root?t.root:0,t.el=t.el?t.el:{},t.tag=t.tag?t.tag:{},t.data=t.data?t.data:{},t.values=t.values?t.values:{},t.str=t.str?t.str:{},t.templates=t.templates?t.templates:{},t.filters=t.filters?t.filters:{},t.change=t.change?t.change:{},t},loadApps:function(t,e){if(t&&t.length){var a=this,i=t.length-1;$.each(t,function(t,s){t==i?a.loadApp(s,e):a.loadApp(s)})}else e&&e()},loadApp:function(t,e){var a=this,i=this.apps[t];i.init&&i.init();var s=i.load?Object.keys(i.load).length:0;if(!s)return a.initApp(t),e&&e(),!1;var n=0;$.each(i.load,function(i,r){if(r.url){var l=r.query?r.query:0;a.ajax(r.url,l,function(r){a.setLoad(t,i,r),++n==s&&(a.initApp(t),e&&e())})}})},setLoad:function(t,e,a){var i=this.apps[t];i.load[e].data=a,i.load[e].loaded&&this.call(a,i.load[e].loaded)},call:function(t,e){var a=e.split("."),i=window.app;return $.each(a,function(t,e){i=i[e]}),i(t||0)},initApp:function(t){var e=this.apps[t];!e.root&&$('[pax="'+t+'"]').length&&(e.root='[pax="'+t+'"]'),e.loaded&&e.loaded(),e.root&&this.renderApp(t),e.ready&&e.ready()},renderApp:function(t){var e=this.apps[t];e.set=function(e,a,i){pax.set(t,e,a,i)},e.push=function(e,a,i){pax.push(t,e,a,i)},e.pop=function(e,a){pax.pop(t,e,a)},e.render=function(){pax.renderChildren(t)},e.template||(e.template=$(e.root).html()),$(e.root).html(this.rendTemplate(t)),this.renderChildren(t),e.root==pax.el.routes&&(this.routeFade&&($(e.root).attr("style","transition:none;opacity:0;"),setTimeout(function(){$(e.root).attr("style","opacity:1; transition: opacity .3s;")},10)),this.routeMove&&$("html, body").animate({scrollTop:0},100))},renderChildren:function(t){var e=this,a=this.apps[t];$(a.root).find("[pax]").each(function(i,s){var n=$(s).prop("tagName"),r=$(s).attr("pax");if(a.el[r]=$(s),"template"==n)return!1;"SELECT"==n&&$(s)[0].hasAttribute("multiple")&&(n="MULTIPLE"),"INPUT"==n&&"checkbox"==$(s).attr("type")&&(n="CHECKBOX"),"INPUT"==n&&"radio"==$(s).attr("type")&&(n="IGNORE"),"INPUT"==n&&"button"==$(s).attr("type")&&(n="BUTTON"),"INPUT"==n&&"submit"==$(s).attr("type")&&(n="BUTTON"),$(s).attr("pax-type")&&(n=$(s).attr("pax-type").toUpperCase()),a.tag[r]=n;$(s).html();switch(n){case"UL":case"OL":a.templates[r]||(a.templates[r]='<li data-index="{{index}}">{{value}}</li>'),a.data[r]?e.render(t,r):(a.data[r]=[],$(s).find("li").each(function(t,e){a.data[r].push($(e).html())}));break;case"RADIO":a.templates[r]||(a.templates[r]="<label><input type='radio' value='{{this.id}}' name='"+r+"'>{{this.text}}</label> "),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find('input[name="'+r+'"]').each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).find('input[name="'+r+'"][value="'+a.values[r].id+'"]').attr("checked",!0),$(a.el[r]).find('input[name="'+r+'"]').on("change",{self:e},function(a){e.setData(t,r)});break;case"CHECKBOX":a.data[r]?($(s).parent().html("<label><input type='checkbox' name='"+r+"' pax='"+r+"' />"+a.data[r].text+"</label>"),a.data[r].id&&$(s).prop("checked",!0)):a.data[r]={id:0,text:$(this).parent().text()},$(a.el[r]).on("change",{self:e},function(e){e.data.self.setData(t,r)});break;case"INPUT":a.data[r]||0==a.data[r]?$(s).val(a.data[r]):a.data[r]=$(s).val(),$(a.el[r]).on("keyup",{self:e},function(e){e.data.self.setData(t,r)});break;case"TEXTAREA":a.data[r]?$(s).html(a.data[r]):a.data[r]=$(s).html(),$(a.el[r]).on("focusout",{self:e},function(e){e.data.self.setData(t,r)});break;case"SELECT":a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).val(a.values[r].id),$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;case"TABLE":var l=a.templates[r]?a.templates[r]:0;$(a.el[r]).html(e.table(a.data[r],l));break;case"MULTIPLE":if(a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]){var o=[];$.each(a.values[r],function(t,e){o.push(e.id)}),o.length&&$(a.el[r]).val(o)}$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;default:a.templates[r]||(a.templates[r]="{{value}}"),a.data[r]||(a.data[r]=$(s).html()),e.render(t,r)}})},render:function(t,e){if(this.apps[t]){if(!e)return this.loadApps([t]);var a=this,i=this.apps[t],s=(i.tag[e],i.data[e]),n="";if(s||(s=""),Array.isArray(s))i.templates[e]?$.each(i.data[e],function(s,r){var l=i.templates[e].valueOf().toString();l=(l=(l=l.split("{{index}}").join(s)).split("{{value}}").join(r)).split("{{this").join("{{"+t+".data."+e+"["+s+"]"),l=a.tempString(l,t,r,e,s),n+=l}):n=JSON.stringify(s);else if("object"==typeof s){if(i.templates[e])r=(r=(r=i.templates[e].valueOf().toString()).split("{{this").join("{{"+t+".data."+e)).split("{{value").join("{{"+t+".data."+e),r=a.tempString(r,t,i.data[e],e),n+=r;else n=JSON.stringify(s)}else{var r,l=i.data[e];if(i.templates[e])r=(r=(r=i.templates[e].valueOf().toString()).split("{{this").join("{{"+t+".data")).split("{{value").join("{{"+t+".data."+e),r=a.tempString(r,t,i.data[e],e),n+=r;else n=l}return $(i.el[e]).html(n),n}alert('App "'+t+'" does not exist')},rendTemplate:function(t){if(!this.apps[t].template)return"";var e=this.apps[t].template.valueOf().toString();return-1==e.indexOf("{{")?e:(e=e.split("this.").join(t+".data."),this.tempString(e,t))},tempString:function(t,e,a,i,s){var n=this;return t.replace(/\{\{[^\}]*\}\}/g,function(t,r){return n.tempValue(t,e,a,i,s)})},tempValue:function(s,key,obj,id,n){var self=this;s=s.replace("{{","").replace("}}","").replace("()",""),s=s.split("||");var v=eval("this.apps."+s[0].trim());return"function"==typeof v&&(v=void 0!==n?v(n,obj):v(obj)),s[1]&&!v&&(v=s[1].trim()),this.apps[key].filters[id]&&(v=this.apps[key].filters[id](v)),void 0!==v?v:""},setData:function(t,e){var a=this.apps[t],i=a.tag[e],s=a.el[e];switch(i){case"RADIO":a.values[e]={id:$(s).find("input:checked"),text:$(s).find('input[value="'+$(s).val()+'"]').html()};break;case"CHECKBOX":var n=$(s).prop("checked")?1:0;a.data[e]=a.values[e]={id:n,text:$(s).parent().text()};break;case"INPUT":case"TEXTAREA":a.values[e]=a.data[e]=$(s).val();break;case"SELECT":a.values[e]={id:$(s).val(),text:$(s).find(":selected").html()};break;case"MULTIPLE":a.values[e]=[];var r=$(s).val();$.each(r,function(t,i){a.values[e].push({id:i,text:$(s).find('option[value="'+i+'"]').html()})});break;default:a.data[e]=$(s).html()}a.change[e]&&a.change[e](a.data[e],e,t)},setHTML:function(t,e){var a=this.apps[t],i=a.data[e],s=a.tag[e],n=a.el[e];switch(s){case"UL":$(n).html(this.render(t,e));break;case"RADIO":a.values[e]&&$(n).find('input[name="'+e+'"][value="'+a.values[e].id+'"]').attr("checked",!0);break;case"CHECKBOX":i?$(n).prop("checked",!0):$(n).prop("checked",!1);break;case"INPUT":case"TEXTAREA":$(n).val(i);break;case"SELECT":a.values[e]&&$(n).val(a.values[e].id);break;case"MULTIPLE":if(a.values[e]){var r=[];$.each(a.values[e],function(t,e){r.push(e.id)}),r.length?$(n).val(r):$(n).val("")}break;default:$(n).html(i)}a.change[e]&&a.change[e](a.data[e])},set:function(t,e,a,i){""==a&&(a=null);var s=this.apps[t];i?this._set(e,i,s.values):this._set(e,a,s.data),e.indexOf(".")>-1&&(e=e.split(".")[0]),s.change[e]&&s.change[e](a,e,t),s.templates[e]&&!i?(this.render(t,e),this.setHTML(t,e)):this.setHTML(t,e)},load:function(t){var e=this;$.each(t,function(t,a){e.set(t,a)})},setVar:function(t,e,a){if(a){var i=e.split("."),s=i.length-1;this.va[t]||(this.va[t]={});var n=this.va[t];$.each(i,function(t,e){n[e]||(n[e]={}),t==s&&(n[e]=a),n=n[e]})}},push:function(t,e,a,i){""==a&&(a=null);var s=this.apps[t];null!=typeof i?s.data[e].splice(i,0,a):s.data[e].push(a),s.change[e]&&s.change[e](s.data[e],e,t),s.templates[e]?this.render(t,e):this.setHTML(t,e)},pop:function(t,e,a){var i=this.apps[t];null!=typeof a?i.data[e].splice(a,1):i.data[e].pop(),i.change[e]&&i.change[e](i.data[e],e,t),i.templates[e]?this.render(t,e):this.setHTML(t,e)},getVals:function(t){var e=this,a={};return $.each(t,function(t,i){a[i]=e.data[i]}),a},print:function(t){if(!t)return alert(JSON.stringify(this.data,null,2));alert(JSON.stringify(t,null,2))},log:function(t){window.console.log(t)},href:function(t){window.location.href=t},link:function(t){window.history.pushState(t,t,t),this.setPath(t)},setRouter:function(){var t=this;this.routeHash?window.addEventListener("hashchange",function(){t.setPath()}):window.onpopstate=function(e){t.setPath(e.state)},this.setGetVars(),this.setPath(0,1)},setPath:function(t,e){this.routeHash?(this.path=location.hash.substr(2),this.url=this.path.split("/")):(this.path=t?t.substr(1):window.location.pathname.substr(1),this.url=this.path.split("/")),e||this.routing()},setGetVars:function(t){var e=window.location.search.substring(1).split("&");pax.getVars={};for(var a=0;a<e.length;a++){var i=e[a].split("=");pax.getVars[i[0]]=i[1]}},routing:function(){for(var t="/error",e="",a="",i=0,s=this.url.length;i<s;i++)e+=i?"/"+this.url[i]:this.url[i],a+=i?"_"+this.url[i]:this.url[i],this.routes["/"+e]&&(t="/"+e),this.routeTags[a]&&a;if(this.routes[t]){this.routeInit&&this.routeInit();var n=this.routes[t];this.activeRoute=this.routes[t],this.loadApps([n]),this.routeReady&&this.routeReady(),$.each(this.apps,function(t,e){e.appReady&&e.appReady()})}},parse:function(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(t){return{error:1,message:"Server Error"}}},ajax:function(t,e,a){var i=this;e?$.post(t,e).done(function(t){i.el.progress&&$(i.el.progress).hide(),a&&a(i.parse(t))}).fail(function(t,e){i.el.progress&&$(i.el.progress).hide(),a&&a({error:!0,xhr:t,status:e})}):$.get(t).done(function(t){a&&a(i.parse(t)),i.el.progress&&$(i.el.progress).hide()}).fail(function(t,e){a&&a({error:!0,xhr:t,status:e}),i.el.progress&&$(i.el.progress).hide()})},_get:function(t,e){return t?(t=t.split("[").join(".").split("]").join("").replace("()",""),e=e||window,t.indexOf(".")<0?void 0!==e[t]?e[t]:"":t.split(".").reduce(function(t,e){return t?t[e]:""},e)):""},_set:function(t,e,a,i){return t?(a=a||window,t.indexOf(".")>-1&&(t=t.split(".")),Array.isArray(t)&&t.length>1?(a.hasOwnProperty(t[0])&&"object"==typeof a[t[0]]||(a[t[0]]=Number.isInteger(parseInt(t[1]))?[]:{}),i=i||a[t[0]],this._set(t.slice(1),e,a[t[0]],i)):(a[t]=e,i)):""},clone:function(t){var e=JSON.parse(JSON.stringify(t));return $.each(t,function(t,a){"function"==typeof a&&(e[t]=a)}),e},table:function(t,e,a,i){var s=this;if(a||(a="id"),!t.length)return"<table><tbody><tr id='tr-0'><td style='text-align:center;'>There are no results</td></tr></tbody></table>";var n="<table><thead><tr>",r="<tbody>";return e?($.each(e,function(t,e){n+=e.thead?"<th>"+e.thead+"</th>":"<th>"+e.id.split("_").join(" ")+"</th>"}),n+="</tr></thead>",$.each(t,function(t,i){r+=i[a]?"<tr data-id='"+i[a]+"' data-index='"+t+"'>":"<tr data-id='"+t+"' data-index='"+t+"'>",$.each(e,function(t,e){var a=s._get(e,i);r+=null!=a?"<td>"+a+"</td>":"<td></td>"}),r+="</tr>"})):($.each(t[0],function(t,e){n+="<th>"+t.split("_").join(" ")+"</th>"}),n+="</tr></thead>",$.each(t,function(t,e){r+=e[a]?"<tr data-id='"+e[a]+"' data-index='"+t+"'>":"<tr data-id='"+t+"' data-index='"+t+"'>",$.each(e,function(t,e){r+=null!=e?"<td>"+e+"</td>":"<td></td>"}),r+="</tr>"})),i?r+"</tbody>":n+r+"</tbody></table>"}};var pax=new $pax,app=pax.apps;$(function(){pax.init()});