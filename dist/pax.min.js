var $pax=function(t){};$pax.prototype={url:[],routes:{},routeTags:{},routeHash:0,apps:{},appLength:0,appIndex:0,loadMethods:{},routeFade:1,routeMove:1,appGlob:[],appInit:[],el:{routes:"#routes"},init:function(t){var e=this;$("template").each(function(){var t=$(this).attr("pax"),a=$(this).html();if(void 0!==t){var n=t.split("_").join("/");"index"==n&&(n=""),e.apps[t]||(e.apps[t]={}),e.apps[t].template||(e.apps[t].template=a),e.apps[t].url||(e.apps[t].url="/"+n)}}),$.each(this.apps,function(t,a){e.setDefaults(a),a.url?(e.routes[a.url]=t,a.root=e.el.routes):a.global?e.appGlob.push(t):a.ignore||e.appInit.push(t)}),this.setRouter(),this.loadApps(e.appGlob,function(){e.loadApps(e.appInit,function(){e.routing()})})},setDefaults:function(t){return t.root=t.root?t.root:0,t.el=t.el?t.el:{},t.tag=t.tag?t.tag:{},t.data=t.data?t.data:{},t.values=t.values?t.values:{},t.str=t.str?t.str:{},t.templates=t.templates?t.templates:{},t.filters=t.filters?t.filters:{},t.change=t.change?t.change:{},t},loadApps:function(t,e){if(t&&t.length){var a=this,n=t.length-1;$.each(t,function(t,i){t==n?a.loadApp(i,e):a.loadApp(i)})}else e&&e()},loadApp:function(t,e){var a=this,n=this.apps[t],i=n.load?Object.keys(n.load).length:0;if(!i)return a.initApp(t),e&&e(),!1;var s=0;$.each(n.load,function(n,r){if(r.url){var l=r.query?r.query:0;a.ajax(r.url,l,function(r){a.setLoad(t,n,r),++s==i&&(a.initApp(t),e&&e())})}})},setLoad:function(t,e,a){var n=this.apps[t];n.load[e].data=a,n.load[e].init&&self.call(a,n.load[e].init),n.load[e].ready&&(self.loadMethods[t]||(self.loadMethods[t]=[]),self.loadMethods[t].push({method:n.load[e].ready,data:a}))},call:function(t,e){var a=e.split("."),n=window.app;return $.each(a,function(t,e){n=n[e]}),n(t||0)},initApp:function(t){var e=this,a=this.apps[t];!a.root&&$('[pax="'+t+'"]').length&&(a.root='[pax="'+t+'"]'),a.prerend&&a.prerend(),a.root&&this.renderApp(t),a.ready&&a.ready(),this.loadMethods[t]&&$.each(this.loadMethods[t],function(t,a){e.call(a.data,a.method)})},renderApp:function(t){var e=this.apps[t];e.set=function(e,a,n){pax.set(t,e,a,n)},e.push=function(e,a,n){pax.push(t,e,a,n)},e.pop=function(e,a){pax.pop(t,e,a)},e.render=function(){pax.renderChildren(t)},e.template||(e.template=$(e.root).html()),$(e.root).html(this.rendTemplate(t)),this.renderChildren(t),e.root==pax.el.routes&&(this.routeFade&&($(e.root).attr("style","transition:none;opacity:0;"),setTimeout(function(){$(e.root).attr("style","opacity:1; transition: opacity .3s;")},10)),this.routeMove&&$("html, body").animate({scrollTop:0},100))},renderChildren:function(t){var e=this,a=this.apps[t];$(a.root).find("[pax]").each(function(n,i){var s=$(i).prop("tagName"),r=$(i).attr("pax");if(a.el[r]=$(i),"template"==s)return!1;"SELECT"==s&&$(i)[0].hasAttribute("multiple")&&(s="MULTIPLE"),"INPUT"==s&&"checkbox"==$(i).attr("type")&&(s="CHECKBOX"),"INPUT"==s&&"radio"==$(i).attr("type")&&(s="IGNORE"),"INPUT"==s&&"button"==$(i).attr("type")&&(s="BUTTON"),"INPUT"==s&&"submit"==$(i).attr("type")&&(s="BUTTON"),$(i).attr("pax-type")&&(s=$(i).attr("pax-type").toUpperCase()),a.tag[r]=s;$(i).html();switch(s){case"UL":case"OL":a.templates[r]||(a.templates[r]='<li data-index="{{index}}">{{value}}</li>'),a.data[r]?e.render(t,r):(a.data[r]=[],$(i).find("li").each(function(t,e){a.data[r].push($(e).html())}));break;case"RADIO":a.templates[r]||(a.templates[r]="<label><input type='radio' value='{{this.id}}' name='"+r+"'>{{this.text}}</label> "),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find('input[name="'+r+'"]').each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).find('input[name="'+r+'"][value="'+a.values[r].id+'"]').attr("checked",!0),$(a.el[r]).find('input[name="'+r+'"]').on("change",{self:e},function(a){e.setData(t,r)});break;case"CHECKBOX":a.data[r]?($(i).parent().html("<label><input type='checkbox' name='"+r+"' pax='"+r+"' />"+a.data[r].text+"</label>"),a.data[r].id&&$(i).prop("checked",!0)):a.data[r]={id:0,text:$(this).parent().text()},$(a.el[r]).on("change",{self:e},function(e){e.data.self.setData(t,r)});break;case"INPUT":a.data[r]||0==a.data[r]?$(i).val(a.data[r]):a.data[r]=e.numString($(i).val()),$(a.el[r]).on("keyup",{self:e},function(e){e.data.self.setData(t,r)});break;case"TEXTAREA":a.data[r]?$(i).html(a.data[r]):a.data[r]=e.numString($(i).html()),$(a.el[r]).on("focusout",{self:e},function(e){e.data.self.setData(t,r)});break;case"SELECT":a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).val(a.values[r].id),$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;case"TABLE":var l=a.templates[r]?a.templates[r]:0;$(a.el[r]).html(e.table(a.data[r],l));break;case"MULTIPLE":if(a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]){var o=[];$.each(a.values[r],function(t,e){o.push(e.id)}),o.length&&$(a.el[r]).val(o)}$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;default:a.templates[r]||(a.templates[r]="{{value}}"),a.data[r]||(a.data[r]=e.numString($(i).html())),e.render(t,r)}})},render:function(t,e){if(!this.apps[t])return"";if(!e)return this.loadApps([t]);var a=this,n=this.apps[t],i=n.data[e],s="";if(i||(i=""),Array.isArray(i))n.templates[e]?$.each(n.data[e],function(i,r){var l=n.templates[e].valueOf().toString();l=(l=l.split("{{index}}").join(i)).split("{{value}}").join(r),l=a.tempString(l,t,r,i,e),s+=l}):s=JSON.stringify(i);else if(n.templates[e]){var r=n.templates[e].valueOf().toString();r="{{value}}"==r?n.data[e]:a.tempString(r,t,n.data[e],0,e),s+=r}else s="object"==typeof i?JSON.stringify(i):i;return $(n.el[e]).html(s),s},tempString:function(t,e,a,n,i){var s=this;return-1==t.indexOf("{{")?t:t.replace(/\{\{[^\}]*\}\}/g,function(t){if((t=t.replace("{{","").replace("}}","")).indexOf(".")>=0){if(parts=t.split("."),k=parts.splice(0,1),t=parts.join(),"this"==k)var e=s._get(t,a);else e=s._get(t,pax.apps[k]);"function"==typeof e&&(e=void 0!==n?e(n,a):e(a))}else e=s._get(t,a);return e})},rendTemplate:function(t){if(!this.apps[t].template)return"";var e=this.apps[t].template.valueOf().toString();return-1==e.indexOf("{{")?e:this.tempString(e,t,this.apps[t].data)},setData:function(t,e){var a=this.apps[t],n=a.tag[e],i=a.el[e];switch(n){case"RADIO":a.values[e]={id:$(i).find("input:checked"),text:$(i).find('input[value="'+$(i).val()+'"]').html()};break;case"CHECKBOX":var s=$(i).prop("checked")?1:0;a.data[e]=a.values[e]={id:s,text:$(i).parent().text()};break;case"INPUT":case"TEXTAREA":a.values[e]=a.data[e]=$(i).val();break;case"SELECT":a.values[e]={id:$(i).val(),text:$(i).find(":selected").html()};break;case"MULTIPLE":a.values[e]=[];var r=$(i).val();$.each(r,function(t,n){a.values[e].push({id:n,text:$(i).find('option[value="'+n+'"]').html()})});break;default:a.data[e]=$(i).html()}a.change[e]&&a.change[e](a.data[e],e,t)},numString:function(t){return t},setHTML:function(t,e){var a=this.apps[t],n=a.data[e],i=a.tag[e],s=a.el[e];switch(i){case"UL":$(s).html(this.render(t,e));break;case"RADIO":a.values[e]&&$(s).find('input[name="'+e+'"][value="'+a.values[e].id+'"]').attr("checked",!0);break;case"CHECKBOX":n?$(s).prop("checked",!0):$(s).prop("checked",!1);break;case"INPUT":case"TEXTAREA":$(s).val(n);break;case"SELECT":a.values[e]&&$(s).val(a.values[e].id);break;case"MULTIPLE":if(a.values[e]){var r=[];$.each(a.values[e],function(t,e){r.push(e.id)}),r.length?$(s).val(r):$(s).val("")}break;default:$(s).html(n)}a.change[e]&&a.change[e](a.data[e])},set:function(t,e,a,n){""==a&&(a=null);var i=this.apps[t];n?this._set(e,n,i.values):this._set(e,a,i.data),e.indexOf(".")>-1&&(e=e.split(".")[0]),i.change[e]&&i.change[e](a,e,t),i.templates[e]&&!n?(this.render(t,e),this.setHTML(t,e)):this.setHTML(t,e)},load:function(t){var e=this;$.each(t,function(t,a){e.set(t,a)})},setVar:function(t,e,a){if(a){var n=e.split("."),i=n.length-1;this.va[t]||(this.va[t]={});var s=this.va[t];$.each(n,function(t,e){s[e]||(s[e]={}),t==i&&(s[e]=a),s=s[e]})}},push:function(t,e,a,n){""==a&&(a=null);var i=this.apps[t];null!=typeof n?i.data[e].splice(n,0,a):i.data[e].push(a),i.change[e]&&i.change[e](i.data[e],e,t),i.templates[e]?this.render(t,e):this.setHTML(t,e)},pop:function(t,e,a){var n=this.apps[t];null!=typeof a?n.data[e].splice(a,1):n.data[e].pop(),n.change[e]&&n.change[e](n.data[e],e,t),n.templates[e]?this.render(t,e):this.setHTML(t,e)},getVals:function(t){var e=this,a={};return $.each(t,function(t,n){a[n]=e.data[n]}),a},print:function(t){if(!t)return alert(JSON.stringify(this.data,null,2));alert(JSON.stringify(t,null,2))},log:function(t){window.console.log(t)},href:function(t){window.location.href=t},link:function(t){window.history.pushState(t,t,t),this.setPath(t)},setRouter:function(){var t=this;this.routeHash?window.addEventListener("hashchange",function(){t.setPath()}):window.onpopstate=function(e){t.setPath(e.state)},this.setGetVars(),this.setPath(0,1)},setPath:function(t,e){this.routeHash?(this.path=location.hash.substr(2),this.url=this.path.split("/")):(this.path=t?t.substr(1):window.location.pathname.substr(1),this.url=this.path.split("/")),e||this.routing()},setGetVars:function(t){var e=window.location.search.substring(1).split("&");pax.getVars={};for(var a=0;a<e.length;a++){var n=e[a].split("=");pax.getVars[n[0]]=n[1]}},routing:function(){for(var t="/error",e="",a="",n=0,i=this.url.length;n<i;n++)e+=n?"/"+this.url[n]:this.url[n],a+=n?"_"+this.url[n]:this.url[n],this.routes["/"+e]&&(t="/"+e),this.routeTags[a]&&a;if(this.routes[t]){this.routeInit&&this.routeInit();var s=this.routes[t];this.activeRoute=this.routes[t],this.loadApps([s]),this.routeReady&&this.routeReady(),$.each(this.apps,function(t,e){e.appReady&&e.appReady()})}},parse:function(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(t){return{error:1,message:"Server Error"}}},ajax:function(t,e,a){var n=this;e?$.post(t,e).done(function(t){n.el.progress&&$(n.el.progress).hide(),a&&a(n.parse(t))}).fail(function(t,e){n.el.progress&&$(n.el.progress).hide(),a&&a({error:!0,xhr:t,status:e})}):$.get(t).done(function(t){a&&a(n.parse(t)),n.el.progress&&$(n.el.progress).hide()}).fail(function(t,e){a&&a({error:!0,xhr:t,status:e}),n.el.progress&&$(n.el.progress).hide()})},_get:function(t,e){return t?(t=t.split("[").join(".").split("]").join("").replace("()",""),e=e||window,t.indexOf(".")<0?void 0!==e[t]?e[t]:"":t.split(".").reduce(function(t,e){return t?t[e]:""},e)):""},_set:function(t,e,a,n){return t?(a=a||window,t.indexOf(".")>-1&&(t=t.split(".")),Array.isArray(t)&&t.length>1?(a.hasOwnProperty(t[0])&&"object"==typeof a[t[0]]||(a[t[0]]=Number.isInteger(parseInt(t[1]))?[]:{}),n=n||a[t[0]],this._set(t.slice(1),e,a[t[0]],n)):(a[t]=e,n)):""},clone:function(t){var e=JSON.parse(JSON.stringify(t));return $.each(t,function(t,a){"function"==typeof a&&(e[t]=a)}),e},table:function(t,e,a,n){var i=this;if(a||(a="id"),!t.length)return"<table><tbody><tr id='tr-0'><td style='text-align:center;'>There are no results</td></tr></tbody></table>";var s="<table><thead><tr>",r="<tbody>";return e?($.each(e,function(t,e){s+=e.thead?"<th>"+e.thead+"</th>":"<th>"+e.id.split("_").join(" ")+"</th>"}),s+="</tr></thead>",$.each(t,function(t,n){r+=n[a]?"<tr data-id='"+n[a]+"' data-index='"+t+"'>":"<tr data-id='"+t+"' data-index='"+t+"'>",$.each(e,function(t,e){var a=i._get(e,n);r+=null!=a?"<td>"+a+"</td>":"<td></td>"}),r+="</tr>"})):($.each(t[0],function(t,e){s+="<th>"+t.split("_").join(" ")+"</th>"}),s+="</tr></thead>",$.each(t,function(t,e){r+=e[a]?"<tr data-id='"+e[a]+"' data-index='"+t+"'>":"<tr data-id='"+t+"' data-index='"+t+"'>",$.each(e,function(t,e){r+=null!=e?"<td>"+e+"</td>":"<td></td>"}),r+="</tr>"})),n?r+"</tbody>":s+r+"</tbody></table>"}};var pax=new $pax,app=pax.apps;$(function(){pax.init()});