var $pax=function(t){};$pax.prototype={url:[],routes:{},routeTags:{},routeHash:0,apps:{},appLength:0,appIndex:0,loadMethods:{},fader:1,el:{routes:"#routes"},init:function(t){var e=this;this.appGlob=[],this.appInit=[],$("template").each(function(){var t=$(this).attr("pax"),a=$(this).attr("pax-url"),i=$(this).html();if(void 0!==t)"index"==(a=t.split("-").join("/"))&&(a=""),e.apps[t]?(e.apps[t].template||(e.apps[t].template=i),e.apps[t].url||(e.apps[t].url="/"+a)):e.apps[t]={template:i,url:"/"+a};else if(void 0!==a){var n=a.split("-").join("/");e.apps[a]={url:"/"+n,template:i}}}),this.setRouter(),$.each(this.apps,function(t,a){e.setDefaults(a),a.url?(e.routes[a.url]=t,a.root=e.el.routes):a.global?e.appGlob.push(t):a.ignore||e.appInit.push(t)}),this.loadApps(e.appGlob,function(){e.loadApps(e.appInit,function(){e.routing()})})},setDefaults:function(t){return t.root=t.root?t.root:0,t.el=t.el?t.el:{},t.tag=t.tag?t.tag:{},t.data=t.data?t.data:{},t.values=t.values?t.values:{},t.str=t.str?t.str:{},t.templates=t.templates?t.templates:{},t.change=t.change?t.change:{},t},loadApps:function(t,e){if(t&&t.length){var a=this;this.appTotal=t.length,this.appIndex=0,$.each(t,function(t,i){a.apps[i].init&&a.apps[i].init(),a.loadRequests(i,e)})}else e&&e()},loadRequests:function(t,e){var a=this,i=this.apps[t],n=i.load?Object.keys(i.load).length:0;if(n){var s=0;$.each(i.load,function(r,l){if(l.url){var o=l.query?l.query:0;a.ajax(l.url,o,function(l){i.load[r].data=l,i.load[r].init&&a.call(l,i.load[r].init),i.load[r].ready&&(a.loadMethods[t]||(a.loadMethods[t]=[]),a.loadMethods[t].push({method:i.load[r].ready,data:l})),s++,a.finished(t,e,n,s)})}else s++,a.finished(t,e,n,s)})}else a.finished(t,e)},call:function(t,e){var a=e.split("."),i=window.app;return $.each(a,function(t,e){i=i[e]}),i(t||0)},finished:function(t,e,a,i){a&&a!=i||(this.appIndex++,this.initApp(t),this.appTotal==this.appIndex&&e&&e())},initApp:function(t){var e=this,a=this.apps[t];!a.root&&$(['pax="'+t+'"']).length&&(a.root='[pax="'+t+'"]'),a.prerend&&a.prerend(),a.root&&this.renderApp(t),a.ready&&a.url&&this.activeRoute==t&&a.ready(),this.loadMethods[t]&&$.each(this.loadMethods[t],function(t,a){e.call(a.data,a.method)})},renderApp:function(t){var e=this.apps[t];e.set=function(e,a,i){pax.set(t,e,a,i)},e.push=function(e,a,i){pax.push(t,e,a,i)},e.pop=function(e,a){pax.pop(t,e,a)},e.template||(e.template=$(e.root).html()),$(e.root).html(this.rendTemplate(t)),this.fader&&$(e.root).hide().fadeIn(),this.renderChildren(t)},renderChildren:function(t){var e=this,a=this.apps[t];$(a.root).find("[pax]").each(function(i,n){var s=$(n).prop("tagName"),r=$(n).attr("pax");if(a.el[r]=$(n),"template"==s)return!1;"SELECT"==s&&$(n)[0].hasAttribute("multiple")&&(s="MULTIPLE"),"INPUT"==s&&"checkbox"==$(n).attr("type")&&(s="CHECKBOX"),"INPUT"==s&&"radio"==$(n).attr("type")&&(s="IGNORE"),"INPUT"==s&&"button"==$(n).attr("type")&&(s="BUTTON"),"INPUT"==s&&"submit"==$(n).attr("type")&&(s="BUTTON"),$(n).attr("pax-type")&&(s=$(n).attr("pax-type").toUpperCase()),a.tag[r]=s;$(n).html();switch(s){case"UL":case"OL":a.templates[r]||(a.templates[r]='<li data-index="{{index}}">{{value}}</li>'),a.data[r]?e.render(t,r):(a.data[r]=[],$(n).find("li").each(function(t,e){a.data[r].push($(e).html())}));break;case"RADIO":a.templates[r]||(a.templates[r]="<label><input type='radio' value='{{this.id}}' name='"+r+"'>{{this.text}}</label> "),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find('input[name="'+r+'"]').each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).find('input[name="'+r+'"][value="'+a.values[r].id+'"]').attr("checked",!0),$(a.el[r]).find('input[name="'+r+'"]').on("change",{self:e},function(a){e.setData(t,r)});break;case"CHECKBOX":a.data[r]?($(n).parent().html("<label><input type='checkbox' name='"+r+"' pax='"+r+"' />"+a.data[r].text+"</label>"),a.data[r].id&&$(n).prop("checked",!0)):a.data[r]={id:0,text:$(this).parent().text()},$(a.el[r]).on("change",{self:e},function(e){e.data.self.setData(t,r)});break;case"INPUT":a.data[r]||0==a.data[r]?$(n).val(a.data[r]):a.data[r]=e.numString($(n).val()),$(a.el[r]).on("keyup",{self:e},function(e){e.data.self.setData(t,r)});break;case"TEXTAREA":a.data[r]?$(n).html(a.data[r]):a.data[r]=e.numString($(n).html()),$(a.el[r]).on("focusout",{self:e},function(e){e.data.self.setData(t,r)});break;case"SELECT":a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]&&$(a.el[r]).val(a.values[r].id),$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;case"TABLE":var l=a.templates[r]?a.templates[r]:0;$(a.el[r]).html(e.table(a.data[r],l));break;case"MULTIPLE":if(a.templates[r]||(a.templates[r]="<option value='{{this.id}}'>{{this.text}}</option>"),a.data[r]?$(a.el[r]).html(e.render(t,r)):(a.data[r]=[],$(a.el[r]).find("option").each(function(t,e){a.data[r].push({id:$(e).val(),text:$(e).html()})})),a.values[r]){var o=[];$.each(a.values[r],function(t,e){o.push(e.id)}),o.length&&$(a.el[r]).val(o)}$(a.el[r]).on("change",{self:e},function(a){e.setData(t,r)});break;default:a.templates[r]||(a.templates[r]="{{value}}"),a.data[r]||(a.data[r]=e.numString($(n).html())),e.render(t,r)}})},render:function(t,e){if(this.apps[t]){if(!e)return this.loadApps([t]);var a=this,i=this.apps[t],n=(i.tag[e],i.data[e]),s="";if(n||(n=""),Array.isArray(n))i.templates[e]?$.each(i.data[e],function(n,r){var l=i.templates[e].valueOf().toString();l=(l=(l=l.split("{{index}}").join(n)).split("{{value}}").join(r)).split("{{this").join("{{"+t+".data."+e+"["+n+"]"),l=a.tempString(l,t,r,n),s+=l}):s=JSON.stringify(n);else if("object"==typeof n){if(i.templates[e])r=(r=(r=i.templates[e].valueOf().toString()).split("{{this").join("{{"+t+".data."+e)).split("{{value").join("{{"+t+".data."+e),r=a.tempString(r,t,i.data[e]),s+=r;else s=JSON.stringify(n)}else{var r,l=i.data[e];if(i.templates[e])r=(r=(r=i.templates[e].valueOf().toString()).split("{{this").join("{{"+t+".data")).split("{{value").join("{{"+t+".data."+e),r=a.tempString(r,t,i.data[e]),s+=r;else s=l}return $(i.el[e]).html(s),s}alert('App "'+t+'" does not exist')},rendTemplate:function(t){if(!this.apps[t].template)return"";var e=this.apps[t].template.valueOf().toString();return-1==e.indexOf("{{")?e:(e=e.split("this.").join(t+".data."),this.tempString(e,t))},tempString:function(t,e,a,i){var n=this;return t.replace(/\{\{[^\}]*\}\}/g,function(t,s){return n.tempValue(t,e,a,i)})},tempValue:function(s,key,obj,n){var self=this;s=s.replace("{{","").replace("}}","").replace("()","");var v=eval("this.apps."+s);return"function"==typeof v&&(v=void 0!==n?v(n,obj):v(obj)),void 0!==v?v:""},setData:function(t,e){var a=this.apps[t],i=a.tag[e],n=a.el[e];switch(i){case"RADIO":a.values[e]={id:$(n).find("input:checked"),text:$(n).find('input[value="'+$(n).val()+'"]').html()};break;case"CHECKBOX":var s=$(n).prop("checked")?1:0;a.data[e]=a.values[e]={id:s,text:$(n).parent().text()};break;case"INPUT":case"TEXTAREA":a.values[e]=a.data[e]=$(n).val();break;case"SELECT":a.values[e]={id:$(n).val(),text:$(n).find(":selected").html()};break;case"MULTIPLE":a.values[e]=[];var r=$(n).val();$.each(r,function(t,i){a.values[e].push({id:i,text:$(n).find('option[value="'+i+'"]').html()})})}a.change[e]&&a.change[e](a.data[e],e,t)},numString:function(t){return t},setHTML:function(t,e){var a=this.apps[t],i=a.data[e],n=a.tag[e],s=a.el[e];switch(n){case"UL":$(s).html(this.render(t,e));break;case"RADIO":a.values[e]&&$(s).find('input[name="'+e+'"][value="'+a.values[e].id+'"]').attr("checked",!0);break;case"CHECKBOX":i?$(s).prop("checked",!0):$(s).prop("checked",!1);break;case"INPUT":case"TEXTAREA":$(s).val(i);break;case"SELECT":a.values[e]&&$(s).val(a.values[e].id);break;case"MULTIPLE":if(a.values[e]){var r=[];$.each(a.values[e],function(t,e){r.push(e.id)}),r.length?$(s).val(r):$(s).val("")}}a.change[e]&&a.change[e](a.data[e])},set:function(t,e,a,i){""==a&&(a=null);var n=this.apps[t];i?this._set(e,a,n.values):this._set(e,a,n.data),e.indexOf(".")>-1&&(e=e.split(".")[0]),n.change[e]&&n.change[e](a,e,t),n.templates[e]&&!i?(this.render(t,e),this.setHTML(t,e)):this.setHTML(t,e)},load:function(t){var e=this;$.each(t,function(t,a){e.set(t,a)})},setVar:function(t,e,a){if(a){var i=e.split("."),n=i.length-1;this.va[t]||(this.va[t]={});var s=this.va[t];$.each(i,function(t,e){s[e]||(s[e]={}),t==n&&(s[e]=a),s=s[e]})}},push:function(t,e,a,i){""==a&&(a=null);var n=this.apps[t];null!=typeof i?n.data[e].splice(i,0,a):n.data[e].push(a),n.change[e]&&n.change[e](n.data[e],e,t),n.templates[e]?this.render(t,e):this.setHTML(t,e)},pop:function(t,e,a){var i=this.apps[t];null!=typeof a?i.data[e].splice(a,1):i.data[e].pop(),i.change[e]&&i.change[e](i.data[e],e,t),i.templates[e]?this.render(t,e):this.setHTML(t,e)},getVals:function(t){var e=this,a={};return $.each(t,function(t,i){a[i]=e.data[i]}),a},print:function(t){if(!t)return alert(JSON.stringify(this.data,null,2));alert(JSON.stringify(t,null,2))},log:function(t){window.console.log(t)},href:function(t){window.location.href=t},link:function(t){window.history.pushState(t,t,t),this.setPath(t)},setRouter:function(){var t=this;this.routeHash?window.addEventListener("hashchange",function(){t.setPath()}):window.onpopstate=function(e){t.setPath(e.state)},this.setPath(0,1)},setPath:function(t,e){this.routeHash?this.url=location.hash.substr(2).split("/"):this.url=t?t.substr(1).split("/"):window.location.pathname.substr(1).split("/"),e||this.routing()},routing:function(){for(var t="/error",e="",a="",i=0,n=this.url.length;i<n;i++)e+=i?"/"+this.url[i]:this.url[i],a+=i?"-"+this.url[i]:this.url[i],this.routes["/"+e]&&(t="/"+e),this.routeTags[a]&&a;if(this.routes[t]){this.routeInit&&this.routeInit();var s=this.routes[t];this.activeRoute=this.routes[t],this.loadApps([s]),this.routeReady&&this.routeReady(),$.each(this.apps,function(t,e){e.appReady&&e.appReady()})}},parse:function(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(t){return{error:1,message:"Server Error"}}},ajax:function(t,e,a){var i=this;e?$.post(t,e).done(function(t){(t=i.parse(t))||(t="{error:1}"),i.animate&&$("html,body").animate({scrollTop:0},"slow"),i.el_progress&&$(i.el_progress).hide(),a?a(t):i.complete(t)}).fail(function(t,e){i.el_progress&&$(i.el_progress).hide(),a?a({error:!0,xhr:t,status:e}):i.complete({error:!0,xhr:t,status:e})}):$.get(t).done(function(t){t=i.parse(t),a&&a(t)}).fail(function(t,e){a?a({error:!0,xhr:t,status:e}):i.complete({error:!0,xhr:t,status:e})})},_get:function(t,e){return t?(e=e||window,t.indexOf(".")<0?void 0!==e[t]?e[t]:"":t.split(".").reduce(function(t,e){return t?t[e]:""},e)):""},_set:function(t,e,a,i){return t?(a=a||window,t.indexOf(".")>-1&&(t=t.split(".")),Array.isArray(t)&&t.length>1?(a.hasOwnProperty(t[0])&&"object"==typeof a[t[0]]||(a[t[0]]=Number.isInteger(parseInt(t[1]))?[]:{}),i=i||a[t[0]],this._set(t.slice(1),e,a[t[0]],i)):(a[t]=e,i)):""},clone:function(t){return JSON.parse(JSON.stringify(t))},table:function(t,e,a){var i=this;if(this.mode=0,a||(a={}),0==t.length)return"<tbody><tr id='tr-0'><td style='text-align:center;'>There are no results</td></tr></tbody>";var n="<thead><tr>";if(e)$.each(e,function(t,e){if(e.thead){var i=a.thClick?"onclick='"+a.thClick+"(this)'":"";n+="<th "+i+" data-id="+e.id+" data-index="+t+">"+e.thead+"</th>"}});else{var s=this.mode?t[0]._source:t[0];$.each(s,function(t,e){n+="<th>"+t+"</th>"})}return n+="</tr></thead><tbody>",e?($.each(t,function(t,s){i.mode&&(s._source._id=s._id),s=i.mode?s._source:s;var r="";a.trAttr&&$.each(a.trAttr,function(t,e){r+=" data-"+e+'="'+s[e]+'"'}),n+="<tr "+r+"  data-index='"+t+"'>",$.each(e,function(t,e){var l=e.id;r="",a.attr&&$.each(a.attr,function(t,e){r+=" data-"+t+'="'+e+'"'}),e.attr&&$.each(e.attr,function(t,e){r+=" data-"+t+'="'+e+'"'});var o=a.tdClick?"onclick='"+a.tdClick+"(this)'":"";e.tdClick&&e.tdClick;var p=e.val?e.val:i._get(l,s);e.key&&(p=e.key[p]),e.call&&(p=e.call(p)),n+=null!=p?"<td "+o+" "+r+">"+p+"</td>":"<td "+o+" "+r+"></td>"}),n+="</tr>"}),n+"</tbody>"):($.each(t,function(t,e){i.mode&&(e._source._id=e._id);var s=(e=i.mode?e._source:e)._id?"data-id='"+e._id+"'":"",r="";a.trAttr&&$.each(a.trAttr,function(t,a){r+=" data-"+a+'="'+e[a]+'"'}),n+="<tr "+r+" "+s+" data-index='"+t+"'>";var l=a.tdClick?"onclick='"+a.tdClick+"(this)'":"";$.each(e,function(t,e){n+=null!=e?"<td "+l+">"+e+"</td>":"<td></td>"}),n+="</tr>"}),n+"</tbody>")}};